BIN     = ckw.exe
RES     = rsrc.res
RM      = rm
OBJ     = main.o \
          option.o \
          selection.o \
          ime_wrap.o \
          misc.o

DEFINES = -DNDEBUG
# --------------------------------------------------------------------

ifdef INSTDIR
all: ver $(INSTDIR)\$(BIN)
else
all: ver $(BIN)
endif

$(INSTDIR)\$(BIN): $(BIN)
	command.com /c copy $(BIN) $(INSTDIR)

clean:
	$(RM) -f $(OBJ) $(RES) $(BIN)

CC      = gcc.exe
CP      = g++.exe
WINDRES = windres.exe -J rc -O coff --include-dir $(<D)
CFLAGS  = -Os -Wall -Wextra \
          -fno-rtti \
          -fno-exceptions \
          -fomit-frame-pointer \
          -c $(DEFINES)
LFLAGS  =
LOPTS   = -Wl,--enable-stdcall-fixup
LIBS    = -s -mwindows -lshlwapi -static-libgcc -static-libstdc++


# --------------------------------------------------------------------

ver:
	cmd /c version.bat > version.h

$(BIN): $(OBJ) $(RES) makefile-gcc
	$(CP) $(LFLAGS) $(OBJ) $(RES) $(LIBS) $(LOPTS) -o $(BIN)

depend.txt: $(patsubst %.o,%.cpp,$(OBJ))
	$(CC) -MM $^ >$@

# --------------------------------------------------------------------

%.o: %.c
	$(CC) $(CFLAGS) $< -o $@

%.o: %.cpp
	$(CP) $(CFLAGS) $< -o $@

%.res: %.rc
	$(WINDRES) -i $< -o $@

# --------------------------------------------------------------------
